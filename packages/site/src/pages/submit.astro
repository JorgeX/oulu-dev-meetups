---
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';
import BaseHead from '../components/BaseHead.astro';
---

<head>
  <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
</head>
<body class="h-full">
  <div class="min-h-full">
    <Header headerText="Submitting your own meetup" />
    <div class="py-8">
      <main>
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
          <div
            class="mx-auto max-w-3xl border border-gray-400 rounded-xl p-8 sm:px-24 bg-gray-50"
          >
            <form id="submit-form">
              <div class="space-y-12">
                <div>
                  <h2 class="text-base font-semibold leading-7 text-gray-900">
                    Submit your meetup like a pleb
                  </h2>
                  <p class="mt-1 text-sm leading-6 text-gray-600">
                    Fill in the data and let github actions work it's magic
                  </p>

                  <div
                    class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"
                  >
                    <div class="sm:col-span-3">
                      <label
                        for="title"
                        class="block text-sm font-medium leading-6 text-gray-900"
                      >
                        Meetup title
                      </label>
                      <div class="mt-2">
                        <div
                          class="flex rounded-md shadow-sm ring-1 ring-inset ring-gray-300 focus-within:ring-2 focus-within:ring-inset focus-within:ring-indigo-600 sm:max-w-md"
                        >
                          <input
                            type="text"
                            name="title"
                            id="title"
                            autocomplete="title"
                            class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
                            placeholder="Let's all learn javascript"
                          />
                        </div>
                      </div>
                    </div>

                    <div class="sm:col-span-3">
                      <label
                        for="signupLink"
                        class="block text-sm font-medium leading-6 text-gray-900"
                      >
                        Signup link for meetup
                      </label>
                      <div class="mt-2">
                        <input
                          type="text"
                          name="signupLink"
                          id="signupLink"
                          class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
                        />
                      </div>
                    </div>

                    <div class="col-span-full">
                      <label
                        for="description"
                        class="block text-sm font-medium leading-6 text-gray-900"
                      >
                        Description
                      </label>
                      <div class="mt-2">
                        <textarea
                          id="description"
                          name="description"
                          rows="3"
                          class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
                        >
                        </textarea>
                      </div>
                      <p class="mt-3 text-sm leading-6 text-gray-600">
                        Tell us more about the meetup. What will attendees
                        learn?
                      </p>
                    </div>
                  </div>
                </div>

                <div class="border-b border-gray-900/10 pb-12">
                  <div
                    class="mt-10 grid grid-cols-1 gap-x-6 gap-y-8 sm:grid-cols-6"
                  >
                    <div class="sm:col-span-3">
                      <label
                        for="organizer"
                        class="block text-sm font-medium leading-6 text-gray-900"
                      >
                        Organizer
                      </label>
                      <div class="mt-2">
                        <input
                          id="organizer"
                          name="organizer"
                          class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
                        />
                      </div>
                    </div>
                    <div class="sm:col-span-3">
                      <label
                        for="organizerLink"
                        class="block text-sm font-medium leading-6 text-gray-900"
                      >
                        Organizer link
                      </label>
                      <div class="mt-2">
                        <input
                          type="text"
                          name="organizerLink"
                          id="organizerLink"
                          class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
                        />
                      </div>
                    </div>

                    <div class="sm:col-span-3">
                      <label
                        for="date"
                        class="block text-sm font-medium leading-6 text-gray-900"
                      >
                        Date
                      </label>
                      <div class="mt-2">
                        <input
                          type="date"
                          name="date"
                          id="date"
                          autocomplete="given-name"
                          class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
                        />
                      </div>
                    </div>

                    <div class="sm:col-span-3">
                      <label
                        for="time"
                        class="block text-sm font-medium leading-6 text-gray-900"
                      >
                        Time
                      </label>
                      <div class="mt-2">
                        <input
                          type="time"
                          name="time"
                          id="time"
                          autocomplete="family-name"
                          class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
                        />
                      </div>
                    </div>
                    <div class="sm:col-span-3 sm:col-start-1">
                      <label
                        for="location"
                        class="block text-sm font-medium leading-6 text-gray-900"
                      >
                        Street address
                      </label>
                      <div class="mt-2">
                        <input
                          type="text"
                          name="location"
                          id="location"
                          class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
                        />
                      </div>
                    </div>

                    <div class="sm:col-span-3">
                      <label
                        for="locationLink"
                        class="block text-sm font-medium leading-6 text-gray-900"
                      >
                        Maps link for address
                      </label>
                      <div class="mt-2">
                        <input
                          type="text"
                          name="locationLink"
                          id="locationLink"
                          class="block w-full rounded-md border-0 py-1.5 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm sm:leading-6"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="mt-6 flex items-center justify-end gap-x-6">
                <button
                  type="button"
                  class="text-sm font-semibold leading-6 text-gray-900"
                >
                  Cancel
                </button>
                <button
                  type="submit"
                  class="rounded-md bg-indigo-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600"
                >
                  Submit
                </button>
              </div>
            </form>
          </div>
        </div>
      </main>
      <Footer />
    </div>
  </div>
</body>

<script>
  const form = document.getElementById('submit-form') as HTMLFormElement;

  const locationInput = document.getElementById('location') as HTMLInputElement;
  const locationLinkInput = document.getElementById(
    'locationLink',
  ) as HTMLInputElement;
  const organizerInput = document.getElementById(
    'organizer',
  ) as HTMLInputElement;
  const organizerLinkInput = document.getElementById(
    'organizerLink',
  ) as HTMLInputElement;
  const signupLinkInput = document.getElementById(
    'signupLink',
  ) as HTMLInputElement;
  const titleInput = document.getElementById('title') as HTMLInputElement;
  const descriptionInput = document.getElementById(
    'description',
  ) as HTMLInputElement;
  const dateInput = document.getElementById('date') as HTMLInputElement;
  const timeInput = document.getElementById('time') as HTMLInputElement;

  locationInput.value = 'Oulu';
  locationLinkInput.value = 'https://goo.gl/maps/oLqThzCH1XmyKcx87';

  organizerInput.value = 'Org';
  organizerLinkInput.value = 'https://google.com';

  signupLinkInput.value = 'https://google.com';
  titleInput.value = 'Title';

  descriptionInput.value = 'Description';

  dateInput.value = '2023-07-23';
  timeInput.value = '18:00';

  function onSubmit(event: Event) {
    event.preventDefault();

    if (!form) {
      console.log("no form element (can't happen btw)");
      return;
    }

    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    console.log(data);

    fetch('http://127.0.0.1:8787', {
      method: 'POST',
      body: JSON.stringify(data),
      headers: { 'Content-Type': 'application/json' },
    })
      .catch((err) => {
        console.error(err);
      })
      .then(async (res) => {
        if (!res) {
          console.log('no response');
          return;
        }

        const json = await res.json();

        console.log(json);
      });
  }

  form.addEventListener('submit', onSubmit, false);
</script>
