---
import PageLayout from '../layouts/PageLayout.astro';
import Intro from '../components/Intro.astro';
import MeetupCard from '../components/MeetupCard.astro';
import { getCollection } from 'astro:content';
import { getMeetupsCollectionName } from '../content/config';
import { createShortDescription, getNextMeetup } from '../utils';

const collectionName = getMeetupsCollectionName();
const meetups: any = await getCollection(collectionName);

const nextMeetup = getNextMeetup(meetups);

const meetupDetails = nextMeetup
  ? {
      name: nextMeetup.data.title,
      location: nextMeetup.data.location,
      locationLink: nextMeetup.data.locationLink,
      date: nextMeetup.data.date,
      time: nextMeetup.data.time,
      organizer: nextMeetup.data.organizer,
      organizerLink: nextMeetup.data.organizerLink,
      signupLink: nextMeetup.data.signupLink,
      slug: nextMeetup.slug,
      description: createShortDescription(nextMeetup.body),
    }
  : null;
---

<PageLayout>
  <div class="mx-auto flex max-w-7xl flex-col sm:px-6 lg:px-8">
    <div class="container">
      <div class="mx-auto max-w-7xl sm:px-6 lg:px-8">
        <div class="relative shadow-xl sm:rounded-2xl">
          <div class="">
            <img
              class="sm:rounded-2xl"
              width={1200}
              height={600}
              src={`${import.meta.env.BASE_URL}images/oulu-devmeetups-hero.jpg`}
              alt="artistic picture of Oulu castle"
            />
          </div>
        </div>
      </div>
    </div>
    <div class="m-4 text-center">
      <Intro />
    </div>
    <div class="m-4 text-center text-2xl">
      <h2>What is coming next?</h2>
    </div>
    {meetupDetails && <MeetupCard {...meetupDetails} />}
  </div>
</PageLayout>
