name: New event

permissions:
    contents: write
    pull-requests: write

on:
    issues:
        types: [opened]

jobs:
    new-event:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout
              uses: actions/checkout@v3

            - name: View the github context
              run: echo "$GITHUB_CONTEXT"
              env:
                  GITHUB_CONTEXT: ${{ toJson(github) }}

            - name: wip
              uses: stefanbuck/github-issue-parser@v3
              id: issue-parser
              with:
                  template-path: .github/ISSUE_TEMPLATE/new-event.yml

            - run: cat ${HOME}/issue-parser-result.json

            - name: Create new event file
              env:
                  DATE: ${{ steps.issue-parser.outputs.issueparser_date }}
                  LOCATION: ${{ steps.issue-parser.outputs.issueparser_location }}
                  JOINING_LINK: ${{ steps.issue-parser.outputs.issueparser_joining_link }}
                  DESCRIPTION: ${{ steps.issue-parser.outputs.issueparser_description }}
              run: |
                  cat <<EOF > new_event.md

                  ---
                  date: $DATE
                  location: $LOCATION
                  organizer: $ORGANISER
                  joining_link: $JOINING_LINK
                  ---

                  $DESCRIPTION
                  EOF

            - name: Create Pull Request
              uses: peter-evans/create-pull-request@v5
